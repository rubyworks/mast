<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type" />

  <title>Class: Mast::Manifest</title>

  
    <link rel="SHORTCUT ICON" href="../assets/icon/class.png">
  

  <link type="text/css" rel="stylesheet" href="../assets/rdoc.css" media="screen" />
  <link type="text/css" rel="stylesheet" href="../assets/highlight/styles/github.css" title="GitHub" />

  <script type="text/javascript" charset="utf-8" src="../assets/jquery.js"></script>
  <script type="text/javascript" charset="utf-8" src="../assets/highlight/highlight.pack.js"></script>
  <script type="text/javascript" charset="utf-8" src="../assets/quicksearch.js"></script>
  <script type="text/javascript" charset="utf-8" src="../assets/main.js"></script>

  <script type="text/javascript">
    $(document).ready( function() {
      hookHighlightSyntax();
	    hookSourceViews();
	    hookDebuggingToggle();
	    hookQuickSearch();
	    highlightLocationTarget();

	    $('ul.link-list a').bind("click", highlightClickTarget);
    });
  </script>
</head>
<body class="class">
<div id="main">

  <div class="head">
    <h1>
      
        <img src="../assets/icon/class.png" align="absmiddle">&nbsp;
      
      <a href="../index.html">Mast</a>&nbsp;
      <a href="/">Mast::Manifest</a>
    </h1>
  </div>

  <div id="metadata">
    <div id="project-metadata">

      <div id="file-list-section" class="section">
        <h3 class="section-header">In Files</h3>
        <div class="section-body">
          <ul>
          
            <li class="file"><a href="../lib/mast/manifest_rb.html?TB_iframe=true&amp;height=550&amp;width=785"
              class="thickbox" title="lib/mast/manifest.rb">lib/mast/manifest.rb</a></li>
          
          </ul>
        </div>
      </div>

      <!-- What about Git info, or Hg info? This seems almost silly, albeit kind of cool. -->
      <!-- TODO: generalize this for all SCMs -->

      
    </div>

    <div id="class-metadata">

      <!-- Parent Class -->
      
      <div id="parent-class-section" class="section">
        <h3 class="section-header">Parent</h3>
        <ul>
          
          <li class="class">Object</li>
          
        </ul>
      </div>
      

      <!-- Namespace Contents -->
      

      <!-- Method Quickref -->
      
      <div id="method-list-section" class="section">
        <h3 class="section-header">Methods</h3>
        <ul class="link-list">
          
            
            <li class="singleton">
              <a href="#method-c-new">::new</a>
            </li>
          
            
            <li class="singleton">
              <a href="#method-c-open">::open</a>
            </li>
          
            
            <li class="method">
              <a href="#method-i-change_options">#change_options</a>
            </li>
          
            
            <li class="method">
              <a href="#method-i-changed%3F">#changed?</a>
            </li>
          
            
            <li class="method">
              <a href="#method-i-chart">#chart</a>
            </li>
          
            
            <li class="method">
              <a href="#method-i-checksum">#checksum</a>
            </li>
          
            
            <li class="method">
              <a href="#method-i-clean">#clean</a>
            </li>
          
            
            <li class="method">
              <a href="#method-i-cleanlist">#cleanlist</a>
            </li>
          
            
            <li class="method">
              <a href="#method-i-create_temporary_manifest">#create_temporary_manifest</a>
            </li>
          
            
            <li class="method">
              <a href="#method-i-diff">#diff</a>
            </li>
          
            
            <li class="method">
              <a href="#method-i-digester">#digester</a>
            </li>
          
            
            <li class="method">
              <a href="#method-i-exclusions">#exclusions</a>
            </li>
          
            
            <li class="method">
              <a href="#method-i-file">#file</a>
            </li>
          
            
            <li class="method">
              <a href="#method-i-filechart">#filechart</a>
            </li>
          
            
            <li class="method">
              <a href="#method-i-filelist">#filelist</a>
            </li>
          
            
            <li class="method">
              <a href="#method-i-filename">#filename</a>
            </li>
          
            
            <li class="method">
              <a href="#method-i-files">#files</a>
            </li>
          
            
            <li class="method">
              <a href="#method-i-generate">#generate</a>
            </li>
          
            
            <li class="method">
              <a href="#method-i-ignores">#ignores</a>
            </li>
          
            
            <li class="method">
              <a href="#method-i-include%3D">#include=</a>
            </li>
          
            
            <li class="method">
              <a href="#method-i-inclusions">#inclusions</a>
            </li>
          
            
            <li class="method">
              <a href="#method-i-list">#list</a>
            </li>
          
            
            <li class="method">
              <a href="#method-i-list_without_folders">#list_without_folders</a>
            </li>
          
            
            <li class="method">
              <a href="#method-i-listing">#listing</a>
            </li>
          
            
            <li class="method">
              <a href="#method-i-output">#output</a>
            </li>
          
            
            <li class="method">
              <a href="#method-i-parse_directory">#parse_directory</a>
            </li>
          
            
            <li class="method">
              <a href="#method-i-parse_file">#parse_file</a>
            </li>
          
            
            <li class="method">
              <a href="#method-i-parse_topline">#parse_topline</a>
            </li>
          
            
            <li class="method">
              <a href="#method-i-read%3F">#read?</a>
            </li>
          
            
            <li class="method">
              <a href="#method-i-read_topline">#read_topline</a>
            </li>
          
            
            <li class="method">
              <a href="#method-i-rec_output">#rec_output</a>
            </li>
          
            
            <li class="method">
              <a href="#method-i-save">#save</a>
            </li>
          
            
            <li class="method">
              <a href="#method-i-showlist">#showlist</a>
            </li>
          
            
            <li class="method">
              <a href="#method-i-to_s">#to_s</a>
            </li>
          
            
            <li class="method">
              <a href="#method-i-topline_string">#topline_string</a>
            </li>
          
            
            <li class="method">
              <a href="#method-i-unlisted">#unlisted</a>
            </li>
          
            
            <li class="method">
              <a href="#method-i-update">#update</a>
            </li>
          
            
            <li class="method">
              <a href="#method-i-verify">#verify</a>
            </li>
          
            
            <li class="method">
              <a href="#method-i-whatsnew">#whatsnew</a>
            </li>
          
            
            <li class="method">
              <a href="#method-i-whatsold">#whatsold</a>
            </li>
          
        </ul>
      </div>
      

      <!-- Included Modules -->
      
    </div>

    <div id="project-metadata">
      
      
      <div id="fileindex-section" class="section project-section">
        <h3 class="section-header">Information</h3>
        <ul>
        
          <li class="file"><a href="../HISTORY_rdoc.html">HISTORY.rdoc</a></li>
        
          <li class="file"><a href="../LICENSE.html">LICENSE</a></li>
        
          <li class="file"><a href="../README_rdoc.html">README.rdoc</a></li>
        
        </ul>
      </div>
      

      <div id="classindex-section" class="section project-section">
        <h3 class="section-header">Class Index
          <span class="search-toggle"><img src="../assets/icon/find.png"
            height="16" width="16" alt="[+]"
            title="show/hide quicksearch" /></span></h3>
        <form action="#" method="get" accept-charset="utf-8" class="initially-hidden">
        <fieldset>
          <legend>Quicksearch</legend>
          <input type="text" name="quicksearch" value=""
            class="quicksearch-field" />
        </fieldset>
        </form>

        <!-- classpage.html : classes -->
        <ul class="link-list">
        
          <li class="module"><a href="../Mast.html">Mast</a></li>
        
          <li class="class"><a href="../Mast/Cli.html">Mast::Cli</a></li>
        
          <li class="class"><a href="../Mast/Manifest.html">Mast::Manifest</a></li>
        
          <li class="module"><a href="../Syckle.html">Syckle</a></li>
        
          <li class="module"><a href="../Syckle/Plugins.html">Syckle::Plugins</a></li>
        
          <li class="class"><a href="../Syckle/Plugins/Mast.html">Syckle::Plugins::Mast</a></li>
        
        </ul>
        <div id="no-class-search-results" style="display: none;">No matching classes.</div>
      </div>
    </div>

    <div id="validator-badges">
      
      <div style="float: right; margin-right: 5px;">
        <a href="http://validator.w3.org/check/referer"><img src="../assets/icon/check.png" alt="[Validate]" height="16" width="16" /></a>
      </div>
      Generated with <a href="http://rubyworks.github.com/rdazzle">RDazzle Redfish</a> 1.4.0
      <br/><br/>
    </div>
  </div>

  <div id="documentation">

    <div id="description">
      
        <h1>Manifest</h1>
      

      <p>
<a href="Manifest.html">Manifest</a> stores a list of package files, and
optionally checksums.
</p>
<p>
The class can be used to create and compare package manifests and digests.
</p>
<p>
TODO: Integrate file signing and general manifest better (?)
</p>
<p>
TODO: Digester is in sign.rb too. Dry-up?
</p>
<p>
TODO: The <a href="Manifest.html#method-i-diff">diff</a> method is shelling
out; this needs to be internalized.
</p>
<p>
TODO: Consider adding @include options rather then scanning entire
directory. But this can&#8217;t be done unless we can write a routine that
can look at @include and reduce it to non-overlapping matches. Eg. [doc,
doc/rdoc] should reduce to just [doc]. Otherwise we will get duplicate
entries, b/c the <a href="Manifest.html#method-i-output">output</a> method
is written for speed and low memory footprint. This might mean @include
can&#8217;t use file globs.
</p>

    </div>

    <!-- Constants -->
    
    <div id="constants-list" class="section">
      <h3 class="section-header">Constants</h3>
      <dl>
      
        <dt><a name="OverwriteError">OverwriteError</a></dt>
        
        <dd class="description"><p>
<a href="Manifest.html">Manifest</a> file overwrite error.
</p></dd>
        
      
        <dt><a name="NoManifestError">NoManifestError</a></dt>
        
        <dd class="description"><p>
No <a href="Manifest.html">Manifest</a> File Error.
</p></dd>
        
      
        <dt><a name="DEFAULT_EXCLUDE">DEFAULT_EXCLUDE</a></dt>
        
        <dd class="description"><p>
By default mast will exclude any pathname matching &#8216;CVS&#8217;,
&#8216;_darcs&#8217;, &#8217;.git*&#8217; or &#8217;.config&#8217;.
</p></dd>
        
      
        <dt><a name="DEFAULT_IGNORE">DEFAULT_IGNORE</a></dt>
        
        <dd class="description"><p>
By default, mast will ignore any file with a name matching
&#8217;.svn&#8217; or &#8217;*~&#8217;, ie. ending with a tilde.
</p></dd>
        
      
        <dt><a name="DEFAULT_FILE">DEFAULT_FILE</a></dt>
        
        <dd class="description"></dd>
        
      
      </dl>
    </div>
    

    <!-- Attributes -->
    
    <div id="attribute-method-details" class="method-section section">
      <h3 class="section-header">Attributes</h3>

      
      <div id="directory-attribute-method" class="method-detail">
        <a name="directory"></a>
        
        <a name="directory="></a>
        
        <div class="method-heading attribute-method-heading">
          <span class="method-name">directory</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        <p>
Directory of manifest.
</p>
        
        </div>
      </div>
      
      <div id="file-attribute-method" class="method-detail">
        <a name="file"></a>
        
        <a name="file="></a>
        
        <div class="method-heading attribute-method-heading">
          <span class="method-name">file</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        <p>
File used to store manifest/digest file.
</p>
        
        </div>
      </div>
      
      <div id="digest-attribute-method" class="method-detail">
        <a name="digest"></a>
        
        <a name="digest="></a>
        
        <div class="method-heading attribute-method-heading">
          <span class="method-name">digest</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        <p>
Encryption type
</p>
        
        </div>
      </div>
      
      <div id="all-attribute-method" class="method-detail">
        <a name="all"></a>
        
        <a name="all="></a>
        
        <div class="method-heading attribute-method-heading">
          <span class="method-name">all</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        <p>
Do not exclude standard exclusions.
</p>
        
        </div>
      </div>
      
      <div id="dir-attribute-method" class="method-detail">
        <a name="dir"></a>
        
        <a name="dir="></a>
        
        <div class="method-heading attribute-method-heading">
          <span class="method-name">dir</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        <p>
Include directories.
</p>
        
        </div>
      </div>
      
      <div id="bang-attribute-method" class="method-detail">
        <a name="bang"></a>
        
        <a name="bang="></a>
        
        <div class="method-heading attribute-method-heading">
          <span class="method-name">bang</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        <p>
Show as if another manifest (i.e. use file&#8217;s bang options).
</p>
        
        </div>
      </div>
      
      <div id="include-attribute-method" class="method-detail">
        <a name="include"></a>
        
        <a name="include="></a>
        
        <div class="method-heading attribute-method-heading">
          <span class="method-name">include</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        <p>
What files to include. Defaults to [&#8217;*&#8217;]. Note that <a
href="../Mast.html">Mast</a> automatically recurses through directory
entries, so using &#8217;*<b>/</b>&#8217; would simply be a waste of of
processing cycles.
</p>
        
        </div>
      </div>
      
      <div id="exclude-attribute-method" class="method-detail">
        <a name="exclude"></a>
        
        <a name="exclude="></a>
        
        <div class="method-heading attribute-method-heading">
          <span class="method-name">exclude</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        <p>
What files to exclude.
</p>
        
        </div>
      </div>
      
      <div id="ignore-attribute-method" class="method-detail">
        <a name="ignore"></a>
        
        <a name="ignore="></a>
        
        <div class="method-heading attribute-method-heading">
          <span class="method-name">ignore</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        <p>
Special files to ignore.
</p>
        
        </div>
      </div>
      
      <div id="format-attribute-method" class="method-detail">
        <a name="format"></a>
        
        <a name="format="></a>
        
        <div class="method-heading attribute-method-heading">
          <span class="method-name">format</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        <p>
Layout of digest &#8212; &#8216;csf&#8217; or &#8216;sfv&#8217;. Default is
&#8216;csf&#8217;.
</p>
        
        </div>
      </div>
      
    </div>
    

    <!-- Methods -->
    
    <div id="public-class-method-details" class="method-section section">
      <h3 class="section-header">Public Class Methods</h3>

    
      <div id="new-method" class="method-detail ">
        <a name="method-c-new"></a>

        <div class="method-heading">
        
          <span class="method-name">new</span><span
            class="method-args">(options={})</span>
          <span class="method-click-advice">click to toggle source</span>
        
        </div>

        <div class="method-description">
          
          <p>
New <a href="Manifest.html">Manifest</a> object.
</p>
          

          
          <div class="method-source-code"
            id="new-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mast/manifest.rb, line 106</span>
106:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">options</span>={})
107:       <span class="ruby-ivar">@include</span>   = [<span class="ruby-value str">'*'</span>]
108:       <span class="ruby-ivar">@exclude</span>   = []
109:       <span class="ruby-ivar">@ignore</span>    = []
110:       <span class="ruby-ivar">@format</span>    = <span class="ruby-value str">'csf'</span>
111:       <span class="ruby-ivar">@all</span>       = <span class="ruby-keyword kw">false</span>
112:       <span class="ruby-ivar">@dir</span>       = <span class="ruby-keyword kw">false</span>
113:       <span class="ruby-ivar">@bang</span>      = <span class="ruby-keyword kw">false</span>
114:       <span class="ruby-ivar">@digest</span>    = <span class="ruby-keyword kw">nil</span>
115:       <span class="ruby-ivar">@directory</span> = <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">pwd</span>
116: 
117:       <span class="ruby-identifier">change_options</span>(<span class="ruby-identifier">options</span>)
118: 
119:       <span class="ruby-comment cmt">#if @file</span>
120:       <span class="ruby-comment cmt">#  read(@file)</span>
121:       <span class="ruby-comment cmt">#else</span>
122:         <span class="ruby-comment cmt">#if file = Dir.glob(self.class.filename)[0]</span>
123:         <span class="ruby-comment cmt">#  @file = file</span>
124:         <span class="ruby-comment cmt">#else</span>
125:       <span class="ruby-comment cmt">#    @file = DEFAULT_FILE</span>
126:         <span class="ruby-comment cmt">#end</span>
127:       <span class="ruby-comment cmt">#end</span>
128:     <span class="ruby-keyword kw">end</span></pre>
          </div>
          
        </div>

        
      </div>

    
      <div id="open-method" class="method-detail ">
        <a name="method-c-open"></a>

        <div class="method-heading">
        
          <span class="method-name">open</span><span
            class="method-args">(file=nil, options={})</span>
          <span class="method-click-advice">click to toggle source</span>
        
        </div>

        <div class="method-description">
          
          <pre>
 Possible file name (was for Fileable?).
</pre>
<p>
def self.filename
</p>
<pre>
  DEFAULT_FILE
</pre>
<p>
end
</p>
          

          
          <div class="method-source-code"
            id="open-source">
<pre>
    <span class="ruby-comment cmt"># File lib/mast/manifest.rb, line 50</span>
50:     <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">file</span>=<span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">options</span>={})
51:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">file</span>
52:         <span class="ruby-identifier">file</span> = <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">glob</span>(<span class="ruby-identifier">filename</span>, <span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-constant">FNM_CASEFOLD</span>).<span class="ruby-identifier">first</span>
53:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">NoManifestError</span>, <span class="ruby-value str">&quot;Manifest file is required.&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">file</span>
54:       <span class="ruby-keyword kw">end</span>
55:       <span class="ruby-identifier">options</span>[<span class="ruby-value">:file</span>] = <span class="ruby-identifier">file</span>
56:       <span class="ruby-identifier">new</span>(<span class="ruby-identifier">options</span>)
57:     <span class="ruby-keyword kw">end</span></pre>
          </div>
          
        </div>

        
      </div>

    
    </div>
  
    <div id="public-instance-method-details" class="method-section section">
      <h3 class="section-header">Public Instance Methods</h3>

    
      <div id="change-options-method" class="method-detail ">
        <a name="method-i-change_options"></a>

        <div class="method-heading">
        
          <span class="method-name">change_options</span><span
            class="method-args">(opts)</span>
          <span class="method-click-advice">click to toggle source</span>
        
        </div>

        <div class="method-description">
          
          <p>
Set options.
</p>
          

          
          <div class="method-source-code"
            id="change-options-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mast/manifest.rb, line 131</span>
131:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">change_options</span>(<span class="ruby-identifier">opts</span>)
132:       <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>,<span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
133:         <span class="ruby-identifier">k</span> = <span class="ruby-identifier">k</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">downcase</span>
134:         <span class="ruby-identifier">send</span>(<span class="ruby-node">&quot;#{k}=&quot;</span>,<span class="ruby-identifier">v</span><span class="ruby-operator">||</span><span class="ruby-identifier">send</span>(<span class="ruby-identifier">k</span>))
135:       <span class="ruby-keyword kw">end</span>
136:       <span class="ruby-comment cmt">#@file       = options[:file]    || @file</span>
137:       <span class="ruby-comment cmt">#@digest     = options[:digest]  || @digest</span>
138:       <span class="ruby-comment cmt">#@all        = options[:all]     || @all</span>
139:       <span class="ruby-comment cmt">#@exclude    = options[:exclude] || options[:ignore] || @exclude</span>
140:       <span class="ruby-comment cmt">#@exclude    = [@exclude].flatten.compact</span>
141:     <span class="ruby-keyword kw">end</span></pre>
          </div>
          
        </div>

        
      </div>

    
      <div id="changed--method" class="method-detail ">
        <a name="method-i-changed%3F"></a>

        <div class="method-heading">
        
          <span class="method-name">changed?</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        
        </div>

        <div class="method-description">
          
          <p>
Is the current mainfest in need of updating?
</p>
          

          
          <div class="method-source-code"
            id="changed--source">
<pre>
     <span class="ruby-comment cmt"># File lib/mast/manifest.rb, line 158</span>
158:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">changed?</span>
159:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">NoManifestError</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">file</span> <span class="ruby-keyword kw">and</span> <span class="ruby-constant">FileTest</span>.<span class="ruby-identifier">file?</span>(<span class="ruby-identifier">file</span>)
160:       <span class="ruby-identifier">txt</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">read</span>(<span class="ruby-identifier">file</span>)
161:       <span class="ruby-identifier">out</span> = <span class="ruby-constant">StringIO</span>.<span class="ruby-identifier">new</span> <span class="ruby-comment cmt">#('', 'w')</span>
162:       <span class="ruby-identifier">generate</span>(<span class="ruby-identifier">out</span>)
163:       <span class="ruby-identifier">out</span>.<span class="ruby-identifier">string</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">txt</span>
164:     <span class="ruby-keyword kw">end</span></pre>
          </div>
          
        </div>

        
      </div>

    
      <div id="chart-method" class="method-detail ">
        <a name="method-i-chart"></a>

        <div class="method-heading">
        
          <span class="method-name">chart</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        
        </div>

        <div class="method-description">
          
          <p>
Chart of current files (name => checksum).
</p>
          

          
          <div class="method-source-code"
            id="chart-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mast/manifest.rb, line 251</span>
251:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">chart</span>
252:       <span class="ruby-ivar">@chart</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">parse_directory</span>
253:     <span class="ruby-keyword kw">end</span></pre>
          </div>
          
        </div>

        
      </div>

    
      <div id="clean-method" class="method-detail ">
        <a name="method-i-clean"></a>

        <div class="method-heading">
        
          <span class="method-name">clean</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        
        </div>

        <div class="method-description">
          
          <p>
Clean non-manifest files.
</p>
          

          
          <div class="method-source-code"
            id="clean-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mast/manifest.rb, line 235</span>
235:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">clean</span>
236:       <span class="ruby-identifier">cfiles</span>, <span class="ruby-identifier">cdirs</span> = <span class="ruby-identifier">cleanlist</span>.<span class="ruby-identifier">partition</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span> <span class="ruby-operator">!</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">directory?</span>(<span class="ruby-identifier">f</span>) }
237:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">cfiles</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">cdirs</span>.<span class="ruby-identifier">empty?</span>
238:         <span class="ruby-identifier">$stderr</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value str">&quot;No difference between list and actual.\n&quot;</span>
239:       <span class="ruby-keyword kw">else</span>
240:         <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rm</span>(<span class="ruby-identifier">cfiles</span>)
241:         <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rmdir</span>(<span class="ruby-identifier">cdirs</span>)
242:       <span class="ruby-keyword kw">end</span>
243:     <span class="ruby-keyword kw">end</span></pre>
          </div>
          
        </div>

        
      </div>

    
      <div id="cleanlist-method" class="method-detail ">
        <a name="method-i-cleanlist"></a>

        <div class="method-heading">
        
          <span class="method-name">cleanlist</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        
        </div>

        <div class="method-description">
          
          
          

          
          <div class="method-source-code"
            id="cleanlist-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mast/manifest.rb, line 266</span>
266:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">cleanlist</span>
267:       <span class="ruby-identifier">showlist</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">filelist</span>
268:     <span class="ruby-keyword kw">end</span></pre>
          </div>
          
        </div>

        
      </div>

    
      <div id="diff-method" class="method-detail ">
        <a name="method-i-diff"></a>

        <div class="method-heading">
        
          <span class="method-name">diff</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        
        </div>

        <div class="method-description">
          
          <p>
Diff file against actual files.
</p>
<p>
TODO: Do not shell out for diff.
</p>
          

          
          <div class="method-source-code"
            id="diff-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mast/manifest.rb, line 202</span>
202:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">diff</span>
203:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">NoManifestError</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">file</span> <span class="ruby-keyword kw">and</span> <span class="ruby-constant">FileTest</span>.<span class="ruby-identifier">file?</span>(<span class="ruby-identifier">file</span>)
204:       <span class="ruby-identifier">parse_topline</span> <span class="ruby-comment cmt"># parse_file unless read?</span>
205:       <span class="ruby-identifier">manifest</span> = <span class="ruby-identifier">create_temporary_manifest</span>
206:       <span class="ruby-keyword kw">begin</span>
207:         <span class="ruby-identifier">result</span> = <span class="ruby-node">`diff -du #{file} #{manifest.file}`</span>
208:       <span class="ruby-keyword kw">ensure</span>
209:         <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rm</span>(<span class="ruby-identifier">manifest</span>.<span class="ruby-identifier">file</span>)
210:       <span class="ruby-keyword kw">end</span>
211:       <span class="ruby-comment cmt"># pass = result.empty?</span>
212:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">result</span>
213:     <span class="ruby-keyword kw">end</span></pre>
          </div>
          
        </div>

        
      </div>

    
      <div id="file-method" class="method-detail ">
        <a name="method-i-file"></a>

        <div class="method-heading">
        
          <span class="method-name">file</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        
        </div>

        <div class="method-description">
          
          
          

          
          <div class="method-source-code"
            id="file-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mast/manifest.rb, line 148</span>
148:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">file</span>
149:       <span class="ruby-ivar">@file</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">glob</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">directory</span>, <span class="ruby-constant">DEFAULT_FILE</span>), <span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-constant">FNM_CASEFOLD</span>).<span class="ruby-identifier">first</span> <span class="ruby-operator">||</span> <span class="ruby-value str">'MANIFEST'</span>
150:     <span class="ruby-keyword kw">end</span></pre>
          </div>
          
        </div>

        
      </div>

    
      <div id="filechart-method" class="method-detail ">
        <a name="method-i-filechart"></a>

        <div class="method-heading">
        
          <span class="method-name">filechart</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        
        </div>

        <div class="method-description">
          
          <p>
Chart of files as given in MANIFEST file (name => checksum).
</p>
          

          
          <div class="method-source-code"
            id="filechart-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mast/manifest.rb, line 261</span>
261:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">filechart</span>
262:       <span class="ruby-ivar">@filechart</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">parse_file</span>
263:     <span class="ruby-keyword kw">end</span></pre>
          </div>
          
        </div>

        
      </div>

    
      <div id="filelist-method" class="method-detail ">
        <a name="method-i-filelist"></a>

        <div class="method-heading">
        
          <span class="method-name">filelist</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        
        </div>

        <div class="method-description">
          
          <p>
List of files as given in MANIFEST file.
</p>
          

          
          <div class="method-source-code"
            id="filelist-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mast/manifest.rb, line 256</span>
256:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">filelist</span>
257:       <span class="ruby-ivar">@filelist</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">filechart</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">sort</span>
258:     <span class="ruby-keyword kw">end</span></pre>
          </div>
          
        </div>

        
      </div>

    
      <div id="filename-method" class="method-detail ">
        <a name="method-i-filename"></a>

        <div class="method-heading">
        
          <span class="method-name">filename</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        
        </div>

        <div class="method-description">
          
          <p>
File&#8217;s basename.
</p>
          

          
          <div class="method-source-code"
            id="filename-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mast/manifest.rb, line 300</span>
300:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">filename</span>
301:       <span class="ruby-constant">File</span>.<span class="ruby-identifier">basename</span>(<span class="ruby-identifier">file</span>)
302:     <span class="ruby-keyword kw">end</span></pre>
          </div>
          
        </div>

        
      </div>

    
      <div id="generate-method" class="method-detail ">
        <a name="method-i-generate"></a>

        <div class="method-heading">
        
          <span class="method-name">generate</span><span
            class="method-args">(out=$stdout)</span>
          <span class="method-click-advice">click to toggle source</span>
        
        </div>

        <div class="method-description">
          
          <p>
Generate manifest.
</p>
          

          
          <div class="method-source-code"
            id="generate-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mast/manifest.rb, line 176</span>
176:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">generate</span>(<span class="ruby-identifier">out</span>=<span class="ruby-identifier">$stdout</span>)
177:       <span class="ruby-identifier">parse_topline</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">read?</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">bang?</span>
178:       <span class="ruby-identifier">out</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">topline_string</span>
179:       <span class="ruby-identifier">output</span>(<span class="ruby-identifier">out</span>)
180:     <span class="ruby-keyword kw">end</span></pre>
          </div>
          
        </div>

        
      </div>

    
      <div id="include--method" class="method-detail ">
        <a name="method-i-include%3D"></a>

        <div class="method-heading">
        
          <span class="method-name">include=</span><span
            class="method-args">(inc)</span>
          <span class="method-click-advice">click to toggle source</span>
        
        </div>

        <div class="method-description">
          
          
          

          
          <div class="method-source-code"
            id="include--source">
<pre>
     <span class="ruby-comment cmt"># File lib/mast/manifest.rb, line 143</span>
143:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">include=</span>(<span class="ruby-identifier">inc</span>)
144:       <span class="ruby-ivar">@include</span> = [<span class="ruby-identifier">inc</span>].<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">uniq</span>
145:     <span class="ruby-keyword kw">end</span></pre>
          </div>
          
        </div>

        
      </div>

    
      <div id="list-method" class="method-detail ">
        <a name="method-i-list"></a>

        <div class="method-heading">
        
          <span class="method-name">list</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        
        </div>

        <div class="method-description">
          
          <p>
List of current files.
</p>
          

          
          <div class="method-source-code"
            id="list-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mast/manifest.rb, line 246</span>
246:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">list</span>
247:       <span class="ruby-ivar">@list</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">chart</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">sort</span>
248:     <span class="ruby-keyword kw">end</span></pre>
          </div>
          
        </div>

        
      </div>

    
      <div id="list-without-folders-method" class="method-detail ">
        <a name="method-i-list_without_folders"></a>

        <div class="method-heading">
        
          <span class="method-name">list_without_folders</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        
        </div>

        <div class="method-description">
          
          <p>
List of files in file system, but omit folders.
</p>
          

          
          <div class="method-source-code"
            id="list-without-folders-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mast/manifest.rb, line 401</span>
401:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">list_without_folders</span>
402:       <span class="ruby-identifier">list</span>.<span class="ruby-identifier">select</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span> <span class="ruby-operator">!</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">directory?</span>(<span class="ruby-identifier">f</span>) }
403:     <span class="ruby-keyword kw">end</span></pre>
          </div>
          
        </div>

        
      </div>

    
      <div id="listing-method" class="method-detail ">
        <a name="method-i-listing"></a>

        <div class="method-heading">
        
          <span class="method-name">listing</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        
        </div>

        <div class="method-description">
          
          <p>
Produce textual listing less the manifest file.
</p>
          

          
          <div class="method-source-code"
            id="listing-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mast/manifest.rb, line 407</span>
407:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">listing</span>
408:       <span class="ruby-identifier">str</span> = <span class="ruby-value str">''</span>
409:       <span class="ruby-identifier">output</span>(<span class="ruby-identifier">str</span>)
410:       <span class="ruby-identifier">str</span>
411:     <span class="ruby-keyword kw">end</span></pre>
          </div>
          
        </div>

        
      </div>

    
      <div id="read--method" class="method-detail ">
        <a name="method-i-read%3F"></a>

        <div class="method-heading">
        
          <span class="method-name">read?</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        
        </div>

        <div class="method-description">
          
          
          

          
          <div class="method-source-code"
            id="read--source">
<pre>
     <span class="ruby-comment cmt"># File lib/mast/manifest.rb, line 153</span>
153:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">read?</span>
154:       <span class="ruby-ivar">@read</span>
155:     <span class="ruby-keyword kw">end</span></pre>
          </div>
          
        </div>

        
      </div>

    
      <div id="save-method" class="method-detail ">
        <a name="method-i-save"></a>

        <div class="method-heading">
        
          <span class="method-name">save</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        
        </div>

        <div class="method-description">
          
          <p>
Save as file.
</p>
          

          
          <div class="method-source-code"
            id="save-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mast/manifest.rb, line 190</span>
190:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">save</span>
191:       <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">file</span>, <span class="ruby-value str">'w'</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">file</span><span class="ruby-operator">|</span>
192:         <span class="ruby-identifier">file</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">topline_string</span>
193:         <span class="ruby-identifier">output</span>(<span class="ruby-identifier">file</span>)
194:       <span class="ruby-keyword kw">end</span>
195:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">file</span>
196:     <span class="ruby-keyword kw">end</span></pre>
          </div>
          
        </div>

        
      </div>

    
      <div id="showlist-method" class="method-detail ">
        <a name="method-i-showlist"></a>

        <div class="method-heading">
        
          <span class="method-name">showlist</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        
        </div>

        <div class="method-description">
          
          
          

          
          <div class="method-source-code"
            id="showlist-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mast/manifest.rb, line 280</span>
280:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">showlist</span>
281:       <span class="ruby-identifier">parse_topline</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">read?</span>
282:       <span class="ruby-identifier">list</span>
283:     <span class="ruby-keyword kw">end</span></pre>
          </div>
          
        </div>

        
      </div>

    
      <div id="to-s-method" class="method-detail ">
        <a name="method-i-to_s"></a>

        <div class="method-heading">
        
          <span class="method-name">to_s</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        
        </div>

        <div class="method-description">
          
          
          

          
          <div class="method-source-code"
            id="to-s-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mast/manifest.rb, line 414</span>
414:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">to_s</span>
415:       <span class="ruby-identifier">topline_string</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">listing</span>
416:     <span class="ruby-keyword kw">end</span></pre>
          </div>
          
        </div>

        
      </div>

    
      <div id="unlisted-method" class="method-detail ">
        <a name="method-i-unlisted"></a>

        <div class="method-heading">
        
          <span class="method-name">unlisted</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        
        </div>

        <div class="method-description">
          
          <p>
Files not listed in manifest.
</p>
          

          
          <div class="method-source-code"
            id="unlisted-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mast/manifest.rb, line 271</span>
271:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">unlisted</span>
272:       <span class="ruby-identifier">list</span> = []
273:       <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">chdir</span>(<span class="ruby-identifier">directory</span>) <span class="ruby-keyword kw">do</span>
274:         <span class="ruby-identifier">list</span> = <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">glob</span>(<span class="ruby-value str">'**/*'</span>)
275:       <span class="ruby-keyword kw">end</span>
276:       <span class="ruby-identifier">list</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">filelist</span>
277:     <span class="ruby-keyword kw">end</span></pre>
          </div>
          
        </div>

        
      </div>

    
      <div id="update-method" class="method-detail ">
        <a name="method-i-update"></a>

        <div class="method-heading">
        
          <span class="method-name">update</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        
        </div>

        <div class="method-description">
          
          <p>
Update file.
</p>
          

          
          <div class="method-source-code"
            id="update-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mast/manifest.rb, line 183</span>
183:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">update</span>
184:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">NoManifestError</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">file</span> <span class="ruby-keyword kw">and</span> <span class="ruby-constant">FileTest</span>.<span class="ruby-identifier">file?</span>(<span class="ruby-identifier">file</span>)
185:       <span class="ruby-identifier">parse_topline</span>
186:       <span class="ruby-identifier">save</span>
187:     <span class="ruby-keyword kw">end</span></pre>
          </div>
          
        </div>

        
      </div>

    
      <div id="verify-method" class="method-detail ">
        <a name="method-i-verify"></a>

        <div class="method-heading">
        
          <span class="method-name">verify</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        
        </div>

        <div class="method-description">
          
          
          

          
          <div class="method-source-code"
            id="verify-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mast/manifest.rb, line 229</span>
229:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">verify</span>
230:       <span class="ruby-identifier">parse_file</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">read?</span>
231:       <span class="ruby-identifier">chart</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">filechart</span>
232:     <span class="ruby-keyword kw">end</span></pre>
          </div>
          
        </div>

        
      </div>

    
      <div id="whatsnew-method" class="method-detail ">
        <a name="method-i-whatsnew"></a>

        <div class="method-heading">
        
          <span class="method-name">whatsnew</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        
        </div>

        <div class="method-description">
          
          <p>
Files found in file system, but not listed in the manifest file.
</p>
          

          
          <div class="method-source-code"
            id="whatsnew-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mast/manifest.rb, line 223</span>
223:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">whatsnew</span>
224:       <span class="ruby-identifier">parse_file</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">read?</span>
225:       <span class="ruby-identifier">list</span> <span class="ruby-operator">-</span> (<span class="ruby-identifier">filelist</span> <span class="ruby-operator">+</span> [<span class="ruby-identifier">filename</span>])
226:     <span class="ruby-keyword kw">end</span></pre>
          </div>
          
        </div>

        
      </div>

    
      <div id="whatsold-method" class="method-detail ">
        <a name="method-i-whatsold"></a>

        <div class="method-heading">
        
          <span class="method-name">whatsold</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        
        </div>

        <div class="method-description">
          
          <p>
Files listed in the manifest file, but not found in file system.
</p>
          

          
          <div class="method-source-code"
            id="whatsold-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mast/manifest.rb, line 217</span>
217:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">whatsold</span>
218:       <span class="ruby-identifier">parse_file</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">read?</span>
219:       <span class="ruby-identifier">filelist</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">list</span>
220:     <span class="ruby-keyword kw">end</span></pre>
          </div>
          
        </div>

        
      </div>

    
    </div>
  
    <div id="private-instance-method-details" class="method-section section">
      <h3 class="section-header">Private Instance Methods</h3>

    
      <div id="checksum-method" class="method-detail ">
        <a name="method-i-checksum"></a>

        <div class="method-heading">
        
          <span class="method-name">checksum</span><span
            class="method-args">(file, digest=nil)</span>
          <span class="method-click-advice">click to toggle source</span>
        
        </div>

        <div class="method-description">
          
          <p>
Produce hexdigest/cheksum for a file. Default digest type is sha1.
</p>
          

          
          <div class="method-source-code"
            id="checksum-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mast/manifest.rb, line 441</span>
441:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">checksum</span>(<span class="ruby-identifier">file</span>, <span class="ruby-identifier">digest</span>=<span class="ruby-keyword kw">nil</span>)
442:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">digest</span>
443:       <span class="ruby-keyword kw">if</span> <span class="ruby-constant">FileTest</span>.<span class="ruby-identifier">directory?</span>(<span class="ruby-identifier">file</span>)
444:         <span class="ruby-comment cmt">#@null_string ||= digester(digest).hexdigest(&quot;&quot;)</span>
445:         <span class="ruby-identifier">listing</span> = (<span class="ruby-constant">Dir</span>.<span class="ruby-identifier">entries</span>(<span class="ruby-identifier">file</span>) <span class="ruby-operator">-</span> <span class="ruby-node">%{. ..}</span>).<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;\n&quot;</span>)
446:         <span class="ruby-identifier">digester</span>(<span class="ruby-identifier">digest</span>).<span class="ruby-identifier">hexdigest</span>(<span class="ruby-identifier">listing</span>)
447:       <span class="ruby-keyword kw">else</span>
448:         <span class="ruby-identifier">digester</span>(<span class="ruby-identifier">digest</span>).<span class="ruby-identifier">hexdigest</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">read</span>(<span class="ruby-identifier">file</span>))
449:       <span class="ruby-keyword kw">end</span>
450:     <span class="ruby-keyword kw">end</span></pre>
          </div>
          
        </div>

        
      </div>

    
      <div id="create-temporary-manifest-method" class="method-detail ">
        <a name="method-i-create_temporary_manifest"></a>

        <div class="method-heading">
        
          <span class="method-name">create_temporary_manifest</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        
        </div>

        <div class="method-description">
          
          <p>
Create temporary manifest (for comparison).
</p>
          

          
          <div class="method-source-code"
            id="create-temporary-manifest-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mast/manifest.rb, line 422</span>
422:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">create_temporary_manifest</span>
423:       <span class="ruby-identifier">temp_manifest</span> = <span class="ruby-constant">Manifest</span>.<span class="ruby-identifier">new</span>(
424:         <span class="ruby-value">:file</span>    =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">file</span><span class="ruby-operator">+</span><span class="ruby-value str">&quot;~&quot;</span>,
425:         <span class="ruby-value">:digest</span>  =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">digest</span>,
426:         <span class="ruby-value">:include</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">include</span>,
427:         <span class="ruby-value">:exclude</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">exclude</span>,
428:         <span class="ruby-value">:ignore</span>  =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ignore</span>,
429:         <span class="ruby-value">:all</span>     =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">all</span>
430:       )
431:       <span class="ruby-identifier">temp_manifest</span>.<span class="ruby-identifier">save</span>
432:       <span class="ruby-comment cmt">#File.open(tempfile, 'w+') do |f|</span>
433:       <span class="ruby-comment cmt">#  f &lt;&lt; to_s(true)</span>
434:       <span class="ruby-comment cmt">#end</span>
435:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">temp_manifest</span>
436:     <span class="ruby-keyword kw">end</span></pre>
          </div>
          
        </div>

        
      </div>

    
      <div id="digester-method" class="method-detail ">
        <a name="method-i-digester"></a>

        <div class="method-heading">
        
          <span class="method-name">digester</span><span
            class="method-args">(type=nil)</span>
          <span class="method-click-advice">click to toggle source</span>
        
        </div>

        <div class="method-description">
          
          <p>
Return a digest class for given <tt>type</tt>. Supported digests are:
</p>
<ul>
<li><p>
md5
</p>
</li>
<li><p>
sha1
</p>
</li>
<li><p>
sha128  (same as sha1)
</p>
</li>
<li><p>
sha256
</p>
</li>
<li><p>
sha512
</p>
</li>
</ul>
<p>
Default digest type is sha256.
</p>
          

          
          <div class="method-source-code"
            id="digester-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mast/manifest.rb, line 463</span>
463:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">digester</span>(<span class="ruby-identifier">type</span>=<span class="ruby-keyword kw">nil</span>)
464:       <span class="ruby-identifier">require</span> <span class="ruby-value str">'openssl'</span>
465:       <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">type</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">downcase</span>
466:       <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'md5'</span>
467:         <span class="ruby-identifier">require</span> <span class="ruby-value str">'digest/md5'</span>
468:         <span class="ruby-operator">::</span><span class="ruby-constant">Digest</span><span class="ruby-operator">::</span><span class="ruby-constant">MD5</span>
469:       <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'sha128'</span>, <span class="ruby-value str">'sha1'</span>
470:         <span class="ruby-identifier">require</span> <span class="ruby-value str">'digest/sha1'</span>  <span class="ruby-comment cmt">#need?</span>
471:         <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">Digest</span><span class="ruby-operator">::</span><span class="ruby-constant">SHA1</span>
472:       <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'sha256'</span>
473:         <span class="ruby-identifier">require</span> <span class="ruby-value str">'digest/sha1'</span>  <span class="ruby-comment cmt">#need?</span>
474:         <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">Digest</span><span class="ruby-operator">::</span><span class="ruby-constant">SHA256</span>
475:       <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'sha512'</span>
476:         <span class="ruby-identifier">require</span> <span class="ruby-value str">'digest/sha1'</span>  <span class="ruby-comment cmt">#need?</span>
477:         <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">Digest</span><span class="ruby-operator">::</span><span class="ruby-constant">SHA512</span>
478:       <span class="ruby-keyword kw">else</span>
479:         <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;unsupported digest #{type}&quot;</span>
480:       <span class="ruby-keyword kw">end</span>
481:     <span class="ruby-keyword kw">end</span></pre>
          </div>
          
        </div>

        
      </div>

    
      <div id="exclusions-method" class="method-detail ">
        <a name="method-i-exclusions"></a>

        <div class="method-heading">
        
          <span class="method-name">exclusions</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        
        </div>

        <div class="method-description">
          
          <p>
Compute exclusions.
</p>
          

          
          <div class="method-source-code"
            id="exclusions-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mast/manifest.rb, line 379</span>
379:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">exclusions</span>
380:       <span class="ruby-ivar">@_exclusions</span> <span class="ruby-operator">||=</span> (
381:         <span class="ruby-identifier">e</span>  = [<span class="ruby-identifier">exclude</span>].<span class="ruby-identifier">flatten</span>
382:         <span class="ruby-identifier">e</span> <span class="ruby-operator">+=</span> <span class="ruby-constant">DEFAULT_EXCLUDE</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">all?</span>
383:         <span class="ruby-identifier">e</span> <span class="ruby-operator">+=</span> [<span class="ruby-identifier">filename</span>, <span class="ruby-identifier">filename</span>.<span class="ruby-identifier">chomp</span>(<span class="ruby-value str">'~'</span>)] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">file</span>
384:         <span class="ruby-identifier">e</span>.<span class="ruby-identifier">map</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">glob</span>(<span class="ruby-identifier">x</span>) }.<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">uniq</span>
385:       )
386:     <span class="ruby-keyword kw">end</span></pre>
          </div>
          
        </div>

        
      </div>

    
      <div id="files-method" class="method-detail ">
        <a name="method-i-files"></a>

        <div class="method-heading">
        
          <span class="method-name">files</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        
        </div>

        <div class="method-description">
          
          <p>
List of files.
</p>
          

          
          <div class="method-source-code"
            id="files-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mast/manifest.rb, line 352</span>
352:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">files</span> <span class="ruby-comment cmt">#(update=false)</span>
353:       <span class="ruby-ivar">@files</span> <span class="ruby-operator">||=</span> (
354:         <span class="ruby-identifier">r</span> = []
355:         <span class="ruby-identifier">output</span>(<span class="ruby-identifier">r</span>)
356:         <span class="ruby-identifier">r</span>
357:       )
358:       <span class="ruby-comment cmt">#files = []</span>
359:       <span class="ruby-comment cmt">#Dir.chdir(directory) do</span>
360:       <span class="ruby-comment cmt">#  files += Dir.multiglob_r('**/*')</span>
361:       <span class="ruby-comment cmt">#  files -= Dir.multiglob_r(exclusions)</span>
362:       <span class="ruby-comment cmt">#end</span>
363:       <span class="ruby-comment cmt">#return files</span>
364:     <span class="ruby-keyword kw">end</span></pre>
          </div>
          
        </div>

        
      </div>

    
      <div id="ignores-method" class="method-detail ">
        <a name="method-i-ignores"></a>

        <div class="method-heading">
        
          <span class="method-name">ignores</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        
        </div>

        <div class="method-description">
          
          <p>
Compute ignores.
</p>
          

          
          <div class="method-source-code"
            id="ignores-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mast/manifest.rb, line 389</span>
389:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">ignores</span>
390:       <span class="ruby-ivar">@_ignores</span> <span class="ruby-operator">||=</span> (
391:         <span class="ruby-identifier">i</span>  = [<span class="ruby-identifier">ignore</span>].<span class="ruby-identifier">flatten</span>
392:         <span class="ruby-identifier">i</span> <span class="ruby-operator">+=</span> [ <span class="ruby-value str">'.'</span>, <span class="ruby-value str">'..'</span> ]
393:         <span class="ruby-identifier">i</span> <span class="ruby-operator">+=</span> <span class="ruby-constant">DEFAULT_IGNORE</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">all?</span>
394:         <span class="ruby-identifier">i</span>
395:       )
396:     <span class="ruby-keyword kw">end</span></pre>
          </div>
          
        </div>

        
      </div>

    
      <div id="inclusions-method" class="method-detail ">
        <a name="method-i-inclusions"></a>

        <div class="method-heading">
        
          <span class="method-name">inclusions</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        
        </div>

        <div class="method-description">
          
          <p>
Compute exclusions.
</p>
          

          
          <div class="method-source-code"
            id="inclusions-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mast/manifest.rb, line 367</span>
367:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">inclusions</span>
368:       <span class="ruby-ivar">@_inclusions</span> <span class="ruby-operator">||=</span> (
369:         <span class="ruby-identifier">e</span>  = [<span class="ruby-identifier">include</span>].<span class="ruby-identifier">flatten</span>
370:         <span class="ruby-comment cmt">#e += DEFAULT_EXCLUDE unless all?</span>
371:         <span class="ruby-comment cmt">#e += [filename, filename.chomp('~')] if file</span>
372:         <span class="ruby-identifier">e</span> = <span class="ruby-identifier">e</span>.<span class="ruby-identifier">map</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">glob</span>(<span class="ruby-identifier">x</span>) }.<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">uniq</span>
373:         <span class="ruby-identifier">e</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">reduce</span>(*<span class="ruby-identifier">e</span>)
374:         <span class="ruby-identifier">e</span>
375:       )
376:     <span class="ruby-keyword kw">end</span></pre>
          </div>
          
        </div>

        
      </div>

    
      <div id="output-method" class="method-detail ">
        <a name="method-i-output"></a>

        <div class="method-heading">
        
          <span class="method-name">output</span><span
            class="method-args">(out=$stdout)</span>
          <span class="method-click-advice">click to toggle source</span>
        
        </div>

        <div class="method-description">
          
          
          

          
          <div class="method-source-code"
            id="output-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mast/manifest.rb, line 307</span>
307:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">output</span>(<span class="ruby-identifier">out</span>=<span class="ruby-identifier">$stdout</span>)
308:       <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">chdir</span>(<span class="ruby-identifier">directory</span>) <span class="ruby-keyword kw">do</span>
309:         <span class="ruby-identifier">exclusions</span>  <span class="ruby-comment cmt"># seed exclusions</span>
310:         <span class="ruby-comment cmt">#rec_output('*', out)</span>
311:         <span class="ruby-identifier">inclusions</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">inc</span><span class="ruby-operator">|</span>
312:           <span class="ruby-identifier">rec_output</span>(<span class="ruby-identifier">inc</span>, <span class="ruby-identifier">out</span>)
313:         <span class="ruby-keyword kw">end</span>
314:       <span class="ruby-keyword kw">end</span>
315:     <span class="ruby-keyword kw">end</span></pre>
          </div>
          
        </div>

        
      </div>

    
      <div id="parse-directory-method" class="method-detail ">
        <a name="method-i-parse_directory"></a>

        <div class="method-heading">
        
          <span class="method-name">parse_directory</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        
        </div>

        <div class="method-description">
          
          
          

          
          <div class="method-source-code"
            id="parse-directory-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mast/manifest.rb, line 342</span>
342:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">parse_directory</span>
343:       <span class="ruby-identifier">h</span> = {}
344:       <span class="ruby-identifier">files</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span>
345:         <span class="ruby-identifier">h</span>[<span class="ruby-identifier">f</span>] = <span class="ruby-identifier">checksum</span>(<span class="ruby-identifier">f</span>)
346:       <span class="ruby-keyword kw">end</span>
347:       <span class="ruby-identifier">h</span>
348:     <span class="ruby-keyword kw">end</span></pre>
          </div>
          
        </div>

        
      </div>

    
      <div id="parse-file-method" class="method-detail ">
        <a name="method-i-parse_file"></a>

        <div class="method-heading">
        
          <span class="method-name">parse_file</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        
        </div>

        <div class="method-description">
          
          <p>
Read manifest file.
</p>
          

          
          <div class="method-source-code"
            id="parse-file-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mast/manifest.rb, line 485</span>
485:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">parse_file</span>
486:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">ManifestMissing</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">file</span>
487: 
488:       <span class="ruby-identifier">parse_topline</span>
489: 
490:       <span class="ruby-comment cmt">#@file = file</span>
491:       <span class="ruby-comment cmt">#@location = File.dirname(File.expand_path(file))</span>
492: 
493:       <span class="ruby-identifier">chart</span> = {}
494:       <span class="ruby-identifier">flist</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">read_list</span>(<span class="ruby-identifier">file</span>)
495:       <span class="ruby-identifier">flist</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">line</span><span class="ruby-operator">|</span>
496:         <span class="ruby-identifier">left</span>, <span class="ruby-identifier">right</span> = <span class="ruby-identifier">line</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp re">/\s+/</span>)
497:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">right</span>
498:           <span class="ruby-identifier">checksum</span> = <span class="ruby-identifier">left</span>
499:           <span class="ruby-identifier">filename</span> = <span class="ruby-identifier">right</span>
500:           <span class="ruby-identifier">chart</span>[<span class="ruby-identifier">filename</span>] = <span class="ruby-identifier">checksum</span>
501:         <span class="ruby-keyword kw">else</span>
502:           <span class="ruby-identifier">filename</span> = <span class="ruby-identifier">left</span>
503:           <span class="ruby-identifier">chart</span>[<span class="ruby-identifier">filename</span>] = <span class="ruby-keyword kw">nil</span>
504:         <span class="ruby-keyword kw">end</span>
505:       <span class="ruby-keyword kw">end</span>
506: 
507:       <span class="ruby-ivar">@read</span>      = <span class="ruby-keyword kw">true</span>
508:       <span class="ruby-ivar">@filechart</span> = <span class="ruby-identifier">chart</span>
509:     <span class="ruby-keyword kw">end</span></pre>
          </div>
          
        </div>

        
      </div>

    
      <div id="parse-topline-method" class="method-detail ">
        <a name="method-i-parse_topline"></a>

        <div class="method-heading">
        
          <span class="method-name">parse_topline</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        
        </div>

        <div class="method-description">
          
          <p>
Parse topline.
</p>
          

          
          <div class="method-source-code"
            id="parse-topline-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mast/manifest.rb, line 518</span>
518:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">parse_topline</span>
519:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">line</span> = <span class="ruby-identifier">read_topline</span>
520:         <span class="ruby-identifier">argv</span> = <span class="ruby-constant">Shellwords</span>.<span class="ruby-identifier">shellwords</span>(<span class="ruby-identifier">line</span>)
521:         <span class="ruby-constant">ARGV</span>.<span class="ruby-identifier">replace</span>(<span class="ruby-identifier">argv</span>)
522:         <span class="ruby-identifier">opts</span> = <span class="ruby-constant">GetoptLong</span>.<span class="ruby-identifier">new</span>(
523:             [ <span class="ruby-value str">'-g'</span>, <span class="ruby-value str">'--digest'</span> , <span class="ruby-constant">GetoptLong</span><span class="ruby-operator">::</span><span class="ruby-constant">REQUIRED_ARGUMENT</span> ],
524:             [ <span class="ruby-value str">'-x'</span>, <span class="ruby-value str">'--exclude'</span>, <span class="ruby-constant">GetoptLong</span><span class="ruby-operator">::</span><span class="ruby-constant">REQUIRED_ARGUMENT</span> ],
525:             [ <span class="ruby-value str">'-i'</span>, <span class="ruby-value str">'--ignore'</span> , <span class="ruby-constant">GetoptLong</span><span class="ruby-operator">::</span><span class="ruby-constant">REQUIRED_ARGUMENT</span> ],
526:             [ <span class="ruby-value str">'-a'</span>, <span class="ruby-value str">'--all'</span>    , <span class="ruby-constant">GetoptLong</span><span class="ruby-operator">::</span><span class="ruby-constant">NO_ARGUMENT</span> ]
527:         )
528:         <span class="ruby-identifier">a</span>, <span class="ruby-identifier">d</span>, <span class="ruby-identifier">g</span>, <span class="ruby-identifier">x</span>, <span class="ruby-identifier">i</span> = <span class="ruby-keyword kw">false</span>, <span class="ruby-keyword kw">false</span>, <span class="ruby-keyword kw">nil</span>, [], []
529:         <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">opt</span>, <span class="ruby-identifier">arg</span><span class="ruby-operator">|</span>
530:           <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">opt</span>
531:           <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'-g'</span>
532:             <span class="ruby-identifier">g</span> = <span class="ruby-identifier">arg</span>.<span class="ruby-identifier">downcase</span>
533:           <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'-a'</span>
534:             <span class="ruby-identifier">a</span> = <span class="ruby-keyword kw">true</span>
535:           <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'-x'</span>
536:             <span class="ruby-identifier">x</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">arg</span>
537:           <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'-i'</span>
538:             <span class="ruby-identifier">i</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">arg</span>
539:           <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'-d'</span>
540:             <span class="ruby-identifier">d</span> = <span class="ruby-keyword kw">true</span>
541:           <span class="ruby-keyword kw">end</span>
542:         <span class="ruby-keyword kw">end</span>
543: 
544:         <span class="ruby-ivar">@all</span>     = <span class="ruby-identifier">a</span>
545:         <span class="ruby-ivar">@digest</span>  = <span class="ruby-identifier">g</span>
546:         <span class="ruby-ivar">@exclude</span> = <span class="ruby-identifier">x</span>
547:         <span class="ruby-ivar">@ignore</span>  = <span class="ruby-identifier">i</span>
548:         <span class="ruby-ivar">@dir</span>     = <span class="ruby-identifier">d</span>
549:         <span class="ruby-ivar">@include</span> = <span class="ruby-constant">ARGV</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">?</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-operator">:</span> <span class="ruby-constant">ARGV</span>.<span class="ruby-identifier">dup</span>
550:       <span class="ruby-keyword kw">end</span>
551:     <span class="ruby-keyword kw">end</span></pre>
          </div>
          
        </div>

        
      </div>

    
      <div id="read-topline-method" class="method-detail ">
        <a name="method-i-read_topline"></a>

        <div class="method-heading">
        
          <span class="method-name">read_topline</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        
        </div>

        <div class="method-description">
          
          <p>
Read topline of MANIFEST file.
</p>
          

          
          <div class="method-source-code"
            id="read-topline-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mast/manifest.rb, line 555</span>
555:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">read_topline</span>
556:       <span class="ruby-identifier">r</span> = <span class="ruby-keyword kw">nil</span>
557:       <span class="ruby-comment cmt">#if file = locate(filename)</span>
558:         <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">file</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span>
559:           <span class="ruby-identifier">s</span> = <span class="ruby-identifier">f</span>.<span class="ruby-identifier">readline</span>
560:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">s</span> <span class="ruby-operator">=~</span> <span class="ruby-node">/^#!mast\s*(.*?)\n/</span>
561:             <span class="ruby-identifier">r</span> = <span class="ruby-node">$1</span>
562:           <span class="ruby-keyword kw">end</span>
563:         <span class="ruby-keyword kw">end</span>
564:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">r</span>
565:       <span class="ruby-comment cmt">#end</span>
566:     <span class="ruby-keyword kw">end</span></pre>
          </div>
          
        </div>

        
      </div>

    
      <div id="rec-output-method" class="method-detail ">
        <a name="method-i-rec_output"></a>

        <div class="method-heading">
        
          <span class="method-name">rec_output</span><span
            class="method-args">(match, out=$stdout)</span>
          <span class="method-click-advice">click to toggle source</span>
        
        </div>

        <div class="method-description">
          
          <p>
Generate listing on the fly.
</p>
          

          
          <div class="method-source-code"
            id="rec-output-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mast/manifest.rb, line 318</span>
318:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">rec_output</span>(<span class="ruby-identifier">match</span>, <span class="ruby-identifier">out</span>=<span class="ruby-identifier">$stdout</span>)
319:       <span class="ruby-identifier">out</span>.<span class="ruby-identifier">flush</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">Array</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">out</span>
320:       <span class="ruby-comment cmt">#match = (location == dir ? '*' : File.join(dir,'*'))</span>
321:       <span class="ruby-identifier">files</span> = <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">glob</span>(<span class="ruby-identifier">match</span>, <span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-constant">FNM_DOTMATCH</span>) <span class="ruby-operator">-</span> <span class="ruby-identifier">exclusions</span>
322:       <span class="ruby-comment cmt"># TODO: Is there a more efficient way to reject ignored files?</span>
323:       <span class="ruby-comment cmt">#files = files.select{ |f| !ignores.any?{ |i| File.fnmatch(i, File.basename(f)) } }</span>
324:       <span class="ruby-identifier">files</span> = <span class="ruby-identifier">files</span>.<span class="ruby-identifier">reject</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span> <span class="ruby-identifier">ignores</span>.<span class="ruby-identifier">any?</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">fnmatch</span>(<span class="ruby-identifier">i</span>, <span class="ruby-constant">File</span>.<span class="ruby-identifier">basename</span>(<span class="ruby-identifier">f</span>)) } }
325:       <span class="ruby-identifier">files</span> = <span class="ruby-identifier">files</span>.<span class="ruby-identifier">sort</span>
326:       <span class="ruby-identifier">files</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">file</span><span class="ruby-operator">|</span>
327:         <span class="ruby-identifier">is_dir</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">directory?</span>(<span class="ruby-identifier">file</span>)
328:         <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">is_dir</span> <span class="ruby-operator">||</span> (<span class="ruby-identifier">is_dir</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">dir?</span>)
329:           <span class="ruby-identifier">sum</span> = <span class="ruby-identifier">checksum</span>(<span class="ruby-identifier">file</span>,<span class="ruby-identifier">digest</span>)
330:           <span class="ruby-identifier">sum</span> = <span class="ruby-identifier">sum</span> <span class="ruby-operator">+</span> <span class="ruby-value str">' '</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">sum</span>
331:           <span class="ruby-identifier">out</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;#{sum}#{file}&quot;</span>
332:           <span class="ruby-identifier">out</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;\n&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">Array</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">out</span>
333:         <span class="ruby-keyword kw">end</span>
334:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">is_dir</span>
335:           <span class="ruby-identifier">rec_output</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">file</span>,<span class="ruby-value str">'*'</span>), <span class="ruby-identifier">out</span>)
336:         <span class="ruby-keyword kw">end</span>
337:       <span class="ruby-keyword kw">end</span>
338:       <span class="ruby-comment cmt">#return out</span>
339:     <span class="ruby-keyword kw">end</span></pre>
          </div>
          
        </div>

        
      </div>

    
      <div id="topline-string-method" class="method-detail ">
        <a name="method-i-topline_string"></a>

        <div class="method-heading">
        
          <span class="method-name">topline_string</span><span
            class="method-args">(update=false)</span>
          <span class="method-click-advice">click to toggle source</span>
        
        </div>

        <div class="method-description">
          
          <p>
Create topline of MANIFEST file.
</p>
          

          
          <div class="method-source-code"
            id="topline-string-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mast/manifest.rb, line 570</span>
570:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">topline_string</span>(<span class="ruby-identifier">update</span>=<span class="ruby-keyword kw">false</span>)
571:       <span class="ruby-comment cmt">#if update</span>
572:       <span class="ruby-comment cmt">#  a = all #|| topline.all</span>
573:       <span class="ruby-comment cmt">#  d = digest #|| topline.digest</span>
574:       <span class="ruby-comment cmt">#  x = exclude #+ topline.exclude</span>
575:       <span class="ruby-comment cmt">#else</span>
576:       <span class="ruby-comment cmt">#  a, d, x = all, digest, exclude</span>
577:       <span class="ruby-comment cmt">#end</span>
578:       <span class="ruby-identifier">top</span> = []
579:       <span class="ruby-identifier">top</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;-a&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">all?</span>
580:       <span class="ruby-identifier">top</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;-d&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">dir?</span>
581:       <span class="ruby-identifier">top</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;-g #{digest.to_s.downcase}&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">digest</span>
582:       <span class="ruby-identifier">exclude</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">e</span><span class="ruby-operator">|</span>
583:         <span class="ruby-identifier">top</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;-x #{e}&quot;</span>
584:       <span class="ruby-keyword kw">end</span>
585:       <span class="ruby-identifier">ignore</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">e</span><span class="ruby-operator">|</span>
586:         <span class="ruby-identifier">top</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;-i #{e}&quot;</span>
587:       <span class="ruby-keyword kw">end</span>
588:       <span class="ruby-identifier">include</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">e</span><span class="ruby-operator">|</span>
589:         <span class="ruby-identifier">top</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">e</span>
590:       <span class="ruby-keyword kw">end</span>
591:       <span class="ruby-keyword kw">return</span> <span class="ruby-node">&quot;#!mast #{top.join(' ')}\n&quot;</span>  <span class="ruby-comment cmt"># FIXME: use proper executable</span>
592:     <span class="ruby-keyword kw">end</span></pre>
          </div>
          
        </div>

        
      </div>

    
    </div>
  

  </div>


  <div id="rdoc-debugging-section-dump" class="debugging-section">
  
    <p>Disabled; run with --debug to generate this.</p>
  
  </div>

</main>
</body>
</html>

